#ifndef _POLY2D_NOMIAL_
#define _POLY2D_NOMIAL_

#include "def2d.h"

//                      use 0-MAXQDORDTRI :MAXQDPTSTRI
extern double QdPtBasTri   [MAXQDORDTRI+1][MAXQDPTSTRI][MAXFVDOF];
extern double QdPtBasDxiTri[MAXQDORDTRI+1][MAXQDPTSTRI][MAXFVDOF];
extern double QdPtBasDetTri[MAXQDORDTRI+1][MAXQDPTSTRI][MAXFVDOF];
//                           use 1-MAXSEGQDPTS :MAXSEGQDPTS
extern double SdQdPtBasTri   [6][MAXSEGQDPTS+1][MAXSEGQDPTS][MAXFVDOF];
extern double SdQdPtBasDxiTri[6][MAXSEGQDPTS+1][MAXSEGQDPTS][MAXFVDOF];
extern double SdQdPtBasDetTri[6][MAXSEGQDPTS+1][MAXSEGQDPTS][MAXFVDOF];
extern double SdQdPtTriXi    [6][MAXSEGQDPTS+1][MAXSEGQDPTS];
extern double SdQdPtTriEt    [6][MAXSEGQDPTS+1][MAXSEGQDPTS];


void   CalBasArrTri  ();
double BasisPolyTri  ( unsigned int dof, double xi, double et );

inline void compute_basis( const double * ref_coord, int poly_dof, double * basis )
{
//	return;
	if( poly_dof > 28 ) poly_dof = 28;
	for( int i = 0; i < poly_dof; ++i )
	{
		basis[i] = BasisPolyTri( i, ref_coord[0], ref_coord[1] );
	}
}

double BasisPolyTriDe( unsigned int dof, double xi, double et, unsigned int twh );

// ndof stand for poly order
inline void GetBasTri( unsigned int ndof, double xi, double et, double *ret )
{
	//double basis[MAXFVDOF];
	for( unsigned int i=0; i<ndof; i++ )
		ret[i] = BasisPolyTri( i, xi, et );
}

// ndof stand for poly order
inline void GetBasDeTri( unsigned int ndof, double xi, double et, unsigned int twh, double *ret )
{
	//double basisde[MAXFVDOF];
	for( unsigned int i=0; i<ndof; i++ )
		ret[i] = BasisPolyTriDe( i, xi, et, twh );
}

void Get_Ortho_basis( 
	unsigned int degree, unsigned int ndim, 
	unsigned int etype, double B[MAXFVDOF][MAXFVDOF] 
);


// 正交基模的倒数
const unsigned int glbpolynorm[15]=
{
	1,
	2,  6,
	3,  9, 15,
	4, 12, 20, 28,
	5, 15, 25, 35, 45
};

const unsigned int modipolynorm[15]=
{
	1,
	1,  3,
	1,  3, 5,
	1,  3, 5, 7,
	1,  3, 5, 7, 9
};

// get from JCP 221 2007 693 mathematics
const double osindiMatrix[15][15]=
{
	{
		0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
	},
	{
		 0.0,                          18.000000000000000000000000,  10.392304845413263761164678,
		-9.7979589711327123927891363,  8.4852813742385702928101323,  10.954451150103322269139396,
		 21.213203435596425732025331,  7.3484692283495342945918522,  9.4868329805051379959966806,
		 11.224972160321824156751246, -15.178932768808220793594689,  6.5726706900619933614836374,
		 8.4852813742385702928101323,  10.039920318408906575738064,  11.384199576606165595196017
	},
	{
		 0.0, 	                       10.392304845413263761164678,  30.000000000000000000000000,
		-5.6568542494923801952067549,  24.494897427831780981972841,  6.3245553203367586639977871,
		 12.247448713915890490986420,  21.213203435596425732025331,  5.4772255750516611345696978,
		 32.403703492039301154829837, -8.7635609200826578153115165,  18.973665961010275991993361,
		 4.8989794855663561963945681,  28.982753492378877147437328,  6.5726706900619933614836374
	},
	{
		 0.0,                         -9.7979589711327123927891363, -5.6568542494923801952067549,
		 1272.0000000000000000000000,  1063.4791958472906582258521,  254.91174943497602539064580,
		-1420.2816622064793806925060,  508.00000000000000000000000,  1874.5239395643897724267645,
		 714.88180841311104102773536,  4418.2994013534211826125060,  1906.0243440208207372191796,
		 1063.4791958472906582258521,  2877.3437750814552260084677,  1372.5852978959085441075317
	},
	{
		 0.0,                          8.4852813742385702928101323,  24.494897427831780981972841,
		 1063.4791958472906582258521,  1920.0000000000000000000000,  960.49986985943938752445782,
		-1200.0000000000000000000000,  886.81001347526517428605253,  2710.1143887297451120479185,
		 1301.7096450437785705267950,  3780.7437363566444186886308,  3377.2414778928675238763194,
		 2424.0000000000000000000000,  5040.4999752008728682673637,  3252.1372664756941344575022
	},
	{
		 0.0,                          10.954451150103322269139396,  6.3245553203367586639977871,
		 254.91174943497602539064580,  960.49986985943938752445782,  2880.0000000000000000000000,
		-294.34673431176368327362417,  406.06994471396180886790594,  4628.0397578240401283053366,
		 688.59509147248501135245380,  952.62794416288251144009549,  1712.0000000000000000000000,
		 6072.8378868532296759610881,  2584.5726919550937637156586,  8244.5618440278559171906446
	},
	{
		 0.0,                          21.213203435596425732025331,  12.247448713915890490986420,
		-1420.2816622064793806925060, -1200.0000000000000000000000, -294.34673431176368327362417,
		 187980.00000000000000000000,  189604.13780294985956786250,  76723.964443972784063191567,
		 11768.301831615298946551187, -327655.51287899918379422904,  3965.9349465163948904235678,
		 412100.00000000000000000000,  294171.15113484530810061783,  63781.602990204001300375270
	},
	{
		 0.0,                          7.3484692283495342945918522,  21.213203435596425732025331,
		 508.00000000000000000000000,  886.81001347526517428605253,  406.06994471396180886790594,
		 189604.13780294985956786250,  288804.00000000000000000000,  200180.56642541503209412958,
		 51874.756866900108874576694, -331040.92772707123381056660,  3713.6616970316507277963556,
		 571888.53564309190477689223,  525439.04259656990205545513,  149531.23941705291703650922
	},
	{
		 0.0,                          9.4868329805051379959966806,  5.4772255750516611345696978,
		 1874.5239395643897724267645,  2710.1143887297451120479185,  4628.0397578240401283053366,
		 76723.964443972784063191567,  200180.56642541503209412958,  348660.00000000000000000000,
		 181519.52633697565926446779, -134380.00000000000000000000, -602.75368103396929814755133,
		 568641.03095010651895563850,  688138.74999741149586474624,  247740.00000000000000000000
	},
	{
		 0.0,                          11.224972160321824156751246,  32.403703492039301154829837,
		 714.88180841311104102773536,  1301.7096450437785705267950,  688.59509147248501135245380,
		 11768.301831615298946551187,  51874.756866900108874576694,  181519.52633697565926446779,
		 544124.00000000000000000000, -20696.813513195696763317541, -1336.2023798811316291720234,
		 242260.10861999428355541652,  1265469.5780599389817952650,  133160.47600481372351262944
	},
	{
		 0.0,                         -15.178932768808220793594689, -8.7635609200826578153115165,
		 4418.2994013534211826125060,  3780.7437363566444186886308,  952.62794416288251144009549,
		-327655.51287899918379422904, -331040.92772707123381056660, -134380.00000000000000000000,
		-20696.813513195696763317541,  48886680.000000000000000000,  55020606.545463782264314412,
		 28888187.054235508047952432,  7875877.7942796953989863908,  884490.00000000000000000000
	},
	{
		 0.0,                          6.5726706900619933614836374,  18.973665961010275991993361,
		 1906.0243440208207372191796,  3377.2414778928675238763194,  1712.0000000000000000000000,
		 3965.9349465163948904235678,  3713.6616970316507277963556, -602.75368103396929814755133,
		-1336.2023798811316291720234,  55020606.545463782264314412,  79659312.000000000000000000,
		 61412099.856538369306852888,  25492749.444071269104809135,  4359582.2749557095610723436
	},
	{
		 0.0,                          8.4852813742385702928101323,  4.8989794855663561963945681,
		 1063.4791958472906582258521,  2424.0000000000000000000000,  6072.8378868532296759610881,
		 412100.00000000000000000000,  571888.53564309190477689223,  568641.03095010651895563850,
		 242260.10861999428355541652,  28888187.054235508047952432,  61412099.856538369306852888,
		 85499280.000000000000000000,  62426762.914022265633839956,  17200036.129046357325852041
	},
	{
		 0.0,                          10.039920318408906575738064,  28.982753492378877147437328,
		 2877.3437750814552260084677,  5040.4999752008728682673637,  2584.5726919550937637156586,
		 294171.15113484530810061783,  525439.04259656990205545513,  688138.74999741149586474624,
		 1265469.5780599389817952650,  7875877.7942796953989863908,  25492749.444071269104809135,
		 62426762.914022265633839956,  108543058.00000000000000000,  57458454.755080616296842486
	},
	{
		 0.0,                          11.384199576606165595196017,  6.5726706900619933614836374,
		 1372.5852978959085441075317,  3252.1372664756941344575022,  8244.5618440278559171906446,
		 63781.602990204001300375270,  149531.23941705291703650922,  247740.00000000000000000000,
		 133160.47600481372351262944,  884490.00000000000000000000,  4359582.2749557095610723436,
		 17200036.129046357325852041,  57458454.755080616296842486,  172460070.00000000000000000
	}
};

#endif